const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d");let gameState="start",currentLevel=1;const totalLevels=13;let animationFrameId,godtime=!1;const player={x:canvas.width/2-25,y:canvas.height-60,width:10,height:10,speed:5,slowSpeed:2,bullets:[],moveLeft:!1,moveRight:!1,moveUp:!1,moveDown:!1,isSlow:!1,canShoot:!0,lives:3,points:0,shoot:function(){this.bullets.push({x:this.x+this.width/2-2.5,y:this.y,width:5,height:10})}},explosions=[];function createExplosion(A,e,t,a){explosions.push({x:A,y:e,size:t,maxSize:a,duration:30,opacity:1})}let bossActive=!1,boss=null;const enemyBullets=[];JZZ.synth.Tiny.register("Web Audio");var out=JZZ().openMidiOut(),smf=new JZZ.MIDI.SMF(op13()),player2=new JZZ.gui.Player({at:"player",midi:!1,loop:!1});let playing=!1;player2.connect(out),player2.onEnd=function(){playing=!1};const instruments=[8,10,16,87,44,113,112,74,107,46,39,47,85];function startMusic(A=1){playing=!0,player2.stop(),player2.load(smf),player2.play(),setTimeout(()=>{out.program(0,instruments[A-1])},1500)}function op13(){return JZZ.lib.fromBase64("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")}function fromBase64(){clear(),load(JZZ.lib.fromBase64(data),"Base64 data")}function drawPlayer(){godtime?ctx.globalAlpha=.5:ctx.globalAlpha=1,ctx.fillStyle="blue",ctx.fillRect(player.x,player.y,player.width,player.height),player.isSlow&&(ctx.fillStyle="red",ctx.beginPath(),ctx.arc(player.x+player.width/2,player.y+player.height/2,3,0,2*Math.PI),ctx.fill()),ctx.globalAlpha=1}function drawPlayerBullets(){ctx.fillStyle="red",player.bullets.forEach((A,e)=>{ctx.fillRect(A.x,A.y,A.width,A.height),A.y-=7,A.y<0&&player.bullets.splice(e,1)})}function drawEnemyBullets(){ctx.fillStyle="yellow",enemyBullets.forEach((A,e)=>{A.x+=A.dx,A.y+=A.dy,ctx.fillRect(A.x,A.y,A.width,A.height),(A.y>canvas.height||A.x<0||A.x>canvas.width)&&enemyBullets.splice(e,1)})}function updatePlayer(){let A=player.isSlow?player.slowSpeed:player.speed;player.moveLeft&&player.x>0&&(player.x-=A),player.moveRight&&player.x<canvas.width-player.width&&(player.x+=A),player.moveUp&&player.y>0&&(player.y-=A),player.moveDown&&player.y<canvas.height-player.height&&(player.y+=A),player.canShoot&&(player.shoot(),player.canShoot=!1,setTimeout(()=>player.canShoot=!0,300))}function drawScreen(A,e="black",t="white"){ctx.fillStyle=e,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle=t,ctx.font="30px Arial",ctx.textAlign="center",A.forEach((A,e)=>{ctx.fillText(A.text,canvas.width/2,canvas.height/2+40*e)})}let bossHitFlash=!1,bossHitTimer=0;function drawBoss(){boss&&(bossHitFlash?(ctx.fillStyle="lightgray",--bossHitTimer<=0&&(bossHitFlash=!1)):ctx.fillStyle="purple",ctx.fillRect(boss.x,boss.y,boss.width,boss.height),boss.x+=boss.speed,(boss.x<=0||boss.x+boss.width>=canvas.width)&&(boss.speed=-boss.speed),.1>Math.random()&&shootBossBullets(boss))}function spawnBoss(A){boss={x:canvas.width/2-75,y:50,width:150,height:150,health:20,speed:1},bossActive=!0}function shootBossBullets(A){A.health>10?generateBulletsPattern(A,3,24,linePattern):A.health>5?generateBulletsPattern(A,3,24,fanPattern):generateBulletsPattern(A,3,12,circlePattern)}function generateBulletsPattern(A,e,t,a){for(let l=0;l<t;l++){let{dx:g,dy:o}=a(l,t,A,player);enemyBullets.push({x:A.x+A.width/2,y:A.y+A.height/2,width:5,height:5,dx:g*e,dy:o*e})}}function circularPattern(A,e){let t=2*Math.PI/e*A;return{dx:Math.cos(t),dy:Math.sin(t)}}function spiralPattern(A,e){let t=2*Math.PI/e*A+Date.now()%1e3/1e3;return{dx:Math.cos(t),dy:Math.sin(t)}}function wavePattern(A,e){return{dx:Math.sin(A/e*Math.PI*2),dy:1}}function linePattern(A,e,t,a){let l=Math.atan2(a.y-t.y,a.x-t.x);return{dx:Math.cos(l),dy:Math.sin(l)}}function circlePattern(A,e,t,a){let l=2*Math.PI/e*A;return{dx:Math.cos(l),dy:Math.sin(l)}}function fanPattern(A,e,t,a){let l=Math.PI/4,g=Math.atan2(a.y-t.y,a.x-t.x),o=g-l/2+l/(e-1)*A;return{dx:Math.cos(o),dy:Math.sin(o)}}function trianglePattern(A,e,t,a){let l=Math.atan2(a.y-t.y,a.x-t.x);return{dx:Math.cos(l+(A%2==0?.3:-.3)),dy:Math.sin(l+(A%2==0?.3:-.3))}}function drawExplosions(){explosions.forEach((A,e)=>{ctx.save(),ctx.globalAlpha=A.opacity,ctx.fillStyle="orange",ctx.beginPath(),ctx.arc(A.x,A.y,A.size,0,2*Math.PI),ctx.fill(),ctx.restore(),A.size<A.maxSize&&(A.size+=1),A.opacity-=.03,A.opacity<=0&&explosions.splice(e,1)})}function checkCollisions(){let A=player.x+player.width/2,e=player.y+player.height/2;player.bullets.forEach((A,e)=>{boss&&A.x<boss.x+boss.width&&A.x+A.width>boss.x&&A.y<boss.y+boss.height&&A.y+A.height>boss.y&&(boss.health--,player.bullets.splice(e,1),player.points+=500,createExplosion(A.x+A.width/2,A.y+A.height/2,5,10),bossHitFlash=!0,bossHitTimer=5,boss.health<=0&&(boss=null,bossActive=!1,player.points+=1e3,advanceLevel()))}),enemyBullets.forEach((t,a)=>{let l=t.x+t.width/2-A,g=t.y+t.height/2-e;3>Math.sqrt(l*l+g*g)&&!godtime&&(player.lives-=1,enemyBullets.splice(a,1),console.log("Player hit! Lives remaining:",player.lives),createExplosion(player.x+player.width/2,player.y+player.height/2,10,30),player.lives<0&&resetGame(),setTimeout(()=>{godtime=!1},1e3),godtime=!0)})}function updateHUD(){document.getElementById("lives").textContent=`Lives: ${player.lives}`,document.getElementById("points").textContent=`Points: ${player.points}`,document.getElementById("level").textContent=`Level: ${currentLevel}`}function advanceLevel(){currentLevel<13?(currentLevel++,initializeGame(!0),spawnBoss(currentLevel)):(gameState="gameOver",drawScreen([{text:"You Win!"},{text:"Thanks for Playing!"},{text:"Press Enter to Restart"}]))}function resetGame(){gameState="gameOver",drawScreen([{text:"Game Over"},{text:"Thanks for Playing!"},{text:"Press Enter to Restart"}])}function initializeGame(A=!1){ctx.clearRect(0,0,canvas.width,canvas.height),player.x=canvas.width/2-player.width/2,player.y=canvas.height-60,player.lives=A?player.lives:3,player.points=A?player.points:0,player.bullets=[],player.moveLeft=!1,player.moveRight=!1,player.moveUp=!1,player.moveDown=!1,player.isSlow=!1,player.canShoot=!0,playing=!1,bossActive=!1,boss=null,enemyBullets.length=0,A?gameState="levelComplete":(currentLevel=1,gameState="start")}function startGameLoop(){animationFrameId&&cancelAnimationFrame(animationFrameId),animationFrameId=requestAnimationFrame(gameLoop)}function gameLoop(){ctx.clearRect(0,0,canvas.width,canvas.height),playing||startMusic(currentLevel),"start"===gameState?drawScreen([{text:"Press Enter to Start"}]):"playing"===gameState?(updatePlayer(),drawPlayerBullets(),drawPlayer(),bossActive&&drawBoss(),drawEnemyBullets(),checkCollisions(),drawExplosions(),updateHUD()):"paused"===gameState?drawScreen([{text:"Paused"},{text:"Press Space to Resume"},{text:"Press Escape to Leave"}],"rgba(0, 0, 0, 0.7)"):"levelComplete"===gameState?(drawScreen([{text:`Level ${currentLevel-1} Complete!`},{text:"Press Enter to Continue"}]),playing=!1):"gameOver"===gameState&&(resetGame(),playing=!1),"gameOver"!==gameState&&(animationFrameId=requestAnimationFrame(gameLoop))}initializeGame(),document.addEventListener("keydown",function(A){"start"===gameState&&"Enter"===A.key?(gameState="playing",spawnBoss(currentLevel)):"playing"===gameState&&"Escape"===A.key?gameState="paused":"paused"===gameState&&" "===A.key?gameState="playing":"paused"===gameState&&"Escape"===A.key?gameState="gameOver":"gameOver"===gameState&&"Enter"===A.key?(initializeGame(),startGameLoop()):"levelComplete"===gameState&&"Enter"===A.key&&(gameState="playing",spawnBoss(currentLevel),startGameLoop())}),document.addEventListener("keydown",function(A){"ArrowLeft"===A.key&&(player.moveLeft=!0),"ArrowRight"===A.key&&(player.moveRight=!0),"ArrowUp"===A.key&&(player.moveUp=!0),"ArrowDown"===A.key&&(player.moveDown=!0),"Shift"===A.key&&(player.isSlow=!0)}),document.addEventListener("keyup",function(A){"ArrowLeft"===A.key&&(player.moveLeft=!1),"ArrowRight"===A.key&&(player.moveRight=!1),"ArrowUp"===A.key&&(player.moveUp=!1),"ArrowDown"===A.key&&(player.moveDown=!1),"Shift"===A.key&&(player.isSlow=!1)}),gameLoop();